
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Online Documentation for Zebra Technologies developer tools and utilties, including EMDK for Android, EMDK for Xamarin, StageNow and Enterprise Browser.">
    <meta name="author" content="Zebra Technologies">
    <meta name="google-site-verification" content="i4B78BrWnNy8ShJwe5feRW3jO3HE6gfYlYqYbxfl8yY">
    <meta name="msvalidate.01" content="6B651B00161BCE79B8950AC09D5C4C75">
    <meta title="File Sharing">
    <title>File Sharing - TechDocs</title>
    <!-- core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
<!--     
    <link href="/css/font-awesome.min.css" rel="stylesheet">
 -->    
    <link href="/css/all.css" rel="stylesheet">
    <link href="/css/v4-shims.css" rel="stylesheet">
    <link href="/css/animate.min.css" rel="stylesheet">
    <link href="/css/owl.carousel.css" rel="stylesheet">
    <link href="/css/owl.transitions.css" rel="stylesheet">
    <link href="/css/prettyPhoto.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/prettify.css" rel="stylesheet">
    <link href="/css/bootstrap-treenav.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]--> 

    <script src="//load.sumome.com/" data-sumo-site-id="699cb66cf4dc59352efb45705526d15cbe314e1cd43f7761b94d96f3cf7338e8" async="async"></script>
    <link rel="shortcut icon" href="/favicon.ico">
<script src="/js/jquery.js"></script></head><!--/head-->


<body id="home" class="homepage" data-spy="scroll" data-offset="100" data-target="#toc">

    <header id="header">
        <nav id="main-menu" class="navbar navbar-default navbar-fixed-top" role="banner">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/"><img src="/images/logo.png" alt="logo" style="max-height:66px;float: inherit;
    padding-right: 3px;"></a> 
                    
                   
                </div>
                <div class="collapse navbar-collapse navbar-left">
                    <ul class="nav navbar-nav">
                        <li class="navbar-text pull-left"><strong>TechDocs</strong></li>
                        <p class="navbar-text">
                                            Secure Storage Manager
                                            1.1
                        </p>

                    </ul>
                </div>
                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        


                        <li>
                            <a href="/ssm/1-1/guide/about">
                                    About
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/guide/share-data">
                                    Data Sharing
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/guide/share-files">
                                    File Sharing
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/guide/api">
                                    APIs
                            </a>
                        </li>
                        <li>
                            <a href="https://developer.zebra.com/forum/search?keys=&amp;field_zebra_curated_tags_tid%5B%5D=184">
                                    <i class="fa fa-comments-o"></i>
                            </a>
                        </li>
                        <li>
                            <a href="/ssm/1-1/search">
                                    <i class="fa fa-search"></i>
                            </a>
                        </li>
                        
                        <!-- <li ><a href="/products">SDKs</a></li>
                        <li ><a href="/samples">Samples</a></li>
                        <li ><a href="/guides">Guides</a></li>
                        <li ><a href="/tutorials">Tutorials</a></li>
                        <li ><a href="/apis">APIs</a></li> -->
                        <!-- <li><a href="#"><input type="text" class="st-default-search-input"></a></li> -->
                    </ul>
                </div>
            </div><!--/.container-->
        </nav><!--/nav-->
    </header><!--/header-->
<div class="container-fluid">
    <section id="blog">
        <div class="">
            <section class="content-with-sidebar">
            <div class="row">
                <div class="col-sm-3 hidden-sm hidden-xs" id="sidebar">
                    
                    
                    <nav id="toc" data-toggle="toc" data-spy="affix" style="height: 75%; max-width: 225px; overflow-y: auto; ">
                        
                        <ul class="nav">
                            <li><strong>File Sharing</strong></li>
                        </ul>
                    </nav>
                    <div class="modal fade" id="modal-smartdocs" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true" data-backdrop="true">
                    	<div class="modal-dialog">
                    		<div class="modal-content">
                    			<div class="modal-header">
                    				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                    			</div>
                    			<div class="modal-body">
                    				<form>
                    				  <div class="form-group">
                    				    <label for="exampleInputEmail1">MX Version On Device:</label>
                    				    <select class="form-control">
                    					  <option value="4.0">4.0</option>
                    					  <option value="4.1">4.1</option>
                    					  <option value="4.2">4.2</option>
                    					  <option value="4.3">4.3</option>
                    					  <option value="5.0">5.0</option>
                    					</select>
                    				  </div>						
                    				  <div class="form-group">
                    				    <label for="exampleInputEmail1">OSX Version On Device:</label>
                    				    <select class="form-control">
                    					  <option value="1.0">1.0</option>
                    					  <option value="1.2">1.2</option>
                    					  <option value="1.3.4-56">1.3.4-56</option>
                    					  <option value="3.4">3.4</option>
                    					  <option value="3.5">3.5</option>
                    					  <option value="3.6">3.6</option>
                    					  <option value="4.1">4.1</option>
                    					  <option value="4.2">4.2</option>
                    					  <option value="4.3">4.3</option>
                    					  <option value="4.4">4.4</option>
                    					</select>
                    				  </div>						
                    				  <div class="form-group">
                    				    <label for="exampleInputEmail1">Android Version On Device:</label>
                    				    <select class="form-control">
                    					  <option value="23">6.0 Marshmallow</option>
                    					  <option value="22">5.1 Lollipop</option>
                    					  <option value="21">5.0 Lollipop</option>
                    					  <option value="19">4.4 Kitkat</option>
                    					  <option value="18">4.3 Jellybean</option>
                    					  <option value="17">4.2.x Jellybean</option>
                    					  <option value="16">4.1.x Jellybean</option>
                    					  <option value="15">4.0.3-4.0.4 Ice Cream Sandwich</option>
                    					  <option value="14">4.0-4.0.2 Ice Cream Sandwich</option>
                    					  <option value="10">2.3.3-2.3.4 Gingerbread</option>
                    					</select>
                    				  </div>
                    				  <div class="form-group">
                    				  	<button class="primary" id="btn_SaveSmartDocOptions">Save Changes</button><button class="primary" id="btn_ClearSmartDocOptions">Clear Changes</button>
                    				  </div>
                    				</form>
                    			</div>
                    	</div>
                      </div>
                    </div>
                    
                    <script type="text/javascript">
                        $(document).ready(function() {
                        	$( "#btn_SaveSmartDocOptions" ).click(function() {
                      			console.log('Saving Options');
                      			$("#modal-smartdocs").modal({show: false});
                    		});
                        	$( "#btn_SaveSmartDocOptions" ).click(function() {
                      			console.log('Clearing Options');
                      			$("#modal-smartdocs").modal({show: false});
                    		});
                        });
                    </script><link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.3.0/dist/bootstrap-toc.min.css">
                    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.3.0/dist/bootstrap-toc.min.js"></script>
                    <script type="text/javascript">
                        $(document).ready(function() {
                    
                        });
                    
                    
                    </script>
                </div>                
                <div class="col-sm-9 ">
                    <div class="row">
                        <div class="col-sm-12">
                            <section id="cta" class="wow fadeIn">
                                <div class="">
                                    <h1 id="file-sharing" class="anchor"><a class="heading-anchor" href="#file-sharing"><span></span></a>File Sharing</h1>
                                    <p>
                                            Secure Storage Manager
                                            1.1
                                    </p>
                                </div>
                            </section>                    
                        </div>
                    </div>
                    <div id="mainContent" class="row">
                        <div class="col-sm-12">
                            <div class="blog-post blog-large wow fadeInLeft" data-wow-duration="300ms" data-wow-delay="0ms">
                            <!-- Start of guide -->
                                <div class="service-box wow fadeInRight">
                                    <div class="">

                                        <p></p><h2 id="overview" class="anchor"><a class="heading-anchor" href="#overview"><span></span></a>Overview</h2>

<p>An application securely shares files with other apps through <strong>Secure Storage Manager (SSM)</strong>, which safely stores files and allows the files to be accessible only by an intended target app. The shared file can be made persistent, remaining on the device after an enterprise reset. The authenticity of the target app is verified with its package name and signature. After the shared file is deployed, the target app can consume the shared file.</p>

<hr>

<h2 id="filedeployment" class="anchor"><a class="heading-anchor" href="#filedeployment"><span></span></a>File Deployment</h2>

<p>Shared files are deployed using one of the following methods:</p>

<ul>
<li><strong>Stagenow or EMM -</strong> The shared file can be deployed to the device via StageNow or EMM for consumption by the target app. </li>

<li><strong>Programmatically -</strong> Store the file in SSM by using the SSM Content Provider insert() API for programmatic file deployment.</li>
</ul>

<p>Details on the use of each method are provided in the sections that follow.</p>

<h3 id="stagenowemm" class="anchor"><a class="heading-anchor" href="#stagenowemm"><span></span></a>StageNow/EMM</h3>

<p>Deploy shared files (such as configuration files) to be accessed or consumed by target apps by using one of the following methods:</p>

<ul>
<li><strong><a href="#stagenow">StageNow</a> -</strong> This is a standard method to overcome <a href="https://developer.android.com/about/versions/11/privacy/storage">scoped storage</a> restrictions enforced in Android 11 or higher. For administrators to deploy files for use by a specific target app, use Zebra’s <a href="/stagenow">StageNow</a> tool with <a href="/stagenow/latest/csp/file/">File Manager</a> to create a staging profile, which specifies the file to be deployed, its source location and the target app. After the staging barcode is generated, the user scans the barcode using the StageNow client on the device. This downloads the file and stores it in SSM. </li>

<li><strong><a href="#EMM">Enterprise Mobility Management (EMM)</a> -</strong> For administrators to deploy files for use by a specific target app via an EMM for large scale deployments, use StageNow and <a href="/oemconfig/latest/mc/#filemanagement">File Management (Zebra Managed Configuration)</a> from OEMConfig. Use EMM client to send Managed Configurations to OEMConfig via File Configuration, which specifies the file to be deployed, its source location and the target app. When the device receives the configurations via OEMConfig, it downloads the file and stores it in SSM.</li>
</ul>

<p>When the file is deployed to the device, SSM automatically detects the presence of the file and stores it securely. The target app is made aware of the deployed file depending on whether or not it is running at the time of deployment:</p>

<ul>
<li>If the <a href="#launchedbeforedeployment">target app is running</a> on the device when the file is deployed, SSM sends an intent notifying the target app of the deployed file along with the file information. </li>

<li>If the <a href="#launchedafterdeployment">target app is not running</a> on the device when the file is deployed, the target app can query SSM for the deployed file using the Content Provider APIs. </li>
</ul>

<p>The target app can then retrieve the file using File Provider and consume the file as needed.</p>

<p><img alt="image" style="height:500px" src="ssm-deployment.jpg"></p>

<p><em>SSM File Deployment</em></p>

<h4 id="stagenow" class="anchor"><a class="heading-anchor" href="#stagenow"><span></span></a>StageNow</h4>

<p>With StageNow, administrators use <a href="/stagenow/latest/csp/file/">File Manager</a> to create a staging profile that deploys the shared file. The target application retrieves the deployed file via <a href="../api">Content Provider</a> and File Provider interfaces exposed via Secure Storage Manager (SSM). File Manager contains an option to set the deployed file to be persistent.</p>

<p>When deploying a file to devices, the following information is required:</p>

<ul>
<li>Full path and package name of the target application that is accessing the deployed file</li>

<li>Signature of the target application in Base64 string format (optional, but recommended for security purposes)</li>

<li>Set whether to persist or not persist the deployed file</li>

<li>Source of the deployed file (remote server or local on the device)</li>

<li>Source path and filename or remote server URI</li>
</ul>

<p>To create a StageNow profile to deploy the file:</p>

<ol>
<li>Open <a href="/stagenow/latest/about/">StageNow</a> on a host computer.</li>

<li>In the StageNow home screen, click <strong>Create New Profile</strong> from the left menu.</li>

<li>Ensure MX version 11.3 or higher is selected at the top drop-down selector. The MX version on the device should match this or higher. See <a href="/mx/mx-version-on-device/">MX documentation</a> for instructions how to check the version. </li>

<li>Select <strong>Xpert Mode</strong> from the list and click <strong>Create.</strong>
<img alt="image" style="height:350px" src="./sn-xpert-mode.png"> </li>

<li>Enter the profile name. Click <strong>Start.</strong></li>

<li>Scroll down and click the plus (+) sign next to <strong>FileMgr.</strong> This adds FileMgr to the Config tab on the right side.
<img alt="image" style="height:350px" src="./sn-config-filemgr.png"> </li>

<li>Click <strong>Add.</strong></li>

<li>Enter or select the following for FileMgr:


<ul>
<li><strong>File Action:</strong> Deploy file for an application </li>

<li><strong>Target Application File Definition:</strong> [Enter the package name of the target app (that is accessing the deployed file) followed by <code>/</code> and the full path of the file]<br>
For example, to deploy a configuration file named "MC93SD.encrypted" located in the "config" folder and have it persist after an enterprise reset for app package “com.ztestapp.clientapplication”, enter: <code>com.ztestapp.clientapplication/config/MC93SD.encrypted</code></li>

<li><strong>Target Application Signature:</strong> [Enter the signature of the target app for security purposes. <i>This is optional, but recommended.</i>]<br> 
The signature must be in Base64 string format, which can be obtained by using <a href="/emdk-for-android/latest/samples/sigtools/">SigTools.jar</a>. If this field is empty, it introduces the risk of compromising the security of the deployed file.</li>

<li><strong>Persist The File:</strong> [Select whether or not to persist the file]</li>

<li><strong>Source Access Method:</strong> [Select whether the source file is located on a remote server or local on the device]


<ul>
<li>If <strong>File on a Remote Server</strong> is selected, enter the <strong>Source File URI</strong> (remote source path).</li>

<li>If <strong>File on the Device File System</strong> is selected, enter the <strong>Source Path and File Name.</strong></li></ul>
</li></ul>
</li>

<li>Click <strong>Complete Profiles.</strong> Profile creation is complete.</li>

<li>Select one of the following based on the deployment method:


<ul>
<li><strong>StageNow:</strong> Generate the barcode from the StageNow profile. Open StageNow client on the device and scan the barcode(s) generated.</li>

<li><strong>EMM:</strong> Export XML from the StageNow profile. Do not edit the XML file - it can cause unexpected behavior. Send the XML using <a href="/oemconfig/latest/mc/">OEMConfig File Management (Zebra Managed Configuration)</a> to be consumed by the EMM.</li></ul>
</li>
</ol>

<h4 id="emm" class="anchor"><a class="heading-anchor" href="#emm"><span></span></a>EMM</h4>

<p>For large scale deployments, administrators use <a href="#stagenow">StageNow</a> to generate the XML (follow the StageNow procedure above). Then, send the XML using <a href="/oemconfig/latest/mc/">File Management (Zebra Managed Configuration)</a> from OEMConfig for consumption by the EMM. </p>

<h3 id="programmatic" class="anchor"><a class="heading-anchor" href="#programmatic"><span></span></a>Programmatic</h3>

<p>For programmatic file deployment, use the insert() API from <a href="../api/">Content Provider</a> to store the file in SSM. The stored file can then be accessed by the target app.</p>

<p>Sample code for programmatic file deployment: </p>

<pre class="prettyprint"><code>    private final String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";

    public void insertFile() {

        Uri cpUriQuery = Uri.parse(AUTHORITY_FILE + context.getPackageName());

        try {

            ContentValues values = new ContentValues();

            values.put("target_app_package", String.format("{\"pkgs_sigs\": [{\"pkg\":\"%s\",\"sig\":\"%s\"}]}", context.getPackageName(), signature));
            values.put("data_name", “sourcePath”);  // Replace “sourcePath” with the source file located in the device, e.g. "/sdcard/A.txt"
            values.put("data_type","3");
            values.put("data_value", “targetPath”); // Replace “targetPath” with the package name of the target app that is accessing the deployed file (or retrieve the app package using context.getPackageName()) followed by "/" and the full path of the file, e.g. "context.getPackageName()/A.txt"
            values.put("data_persist_required", true);

            Uri createdRow  = context.getContentResolver().insert(cpUriQuery, values);

            Log.i(TAG, "SSM Insert File: " + createdRow.toString());

        } catch(Exception e){

            Log.e(TAG, "SSM Insert File - error: " + e.getMessage() + "\n\n");
        }
    }
</code></pre>

<hr>

<h2 id="targetapp" class="anchor"><a class="heading-anchor" href="#targetapp"><span></span></a>Target App</h2>

<p>After the shared file is deployed, it is ready to be accessed by the intended target app on the device. Target apps consuming the deployed or shared file must target API Level 30 (Android 11) or above and have the appropriate access permissions in the manifest file:</p>

<ul>
<li><p>Add permissions to access the SSM Content and File Provider:</p>

<pre class="prettyprint"><code>&lt;uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.WRITE" /&gt;
&lt;uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.READ" /&gt;
</code></pre></li>

<li><p>Add the Query provider:</p>

<pre class="prettyprint"><code>&lt;queries&gt;
    &lt;provider android:authorities="com.zebra.securestoragemanager.securecontentprovider"/&gt; 
&lt;/queries&gt;
</code></pre></li>
</ul>

<p>The method to receive notification of the deployed shared file varies depending on whether or not the target app is running on the device prior to file deployment.</p>

<h3 id="launchedbeforedeployment" class="anchor"><a class="heading-anchor" href="#launchedbeforedeployment"><span></span></a>Launched Before Deployment</h3>

<p>If the target app is already running on the device when the file is deployed or shared, SSM broadcasts an explicit intent to notify the target app. The target app must register for the broadcast receiver to receive this intent and process the intent extras to retrieve the file information. SSM implemented a File Provider, which generates the content URIs for the file. The file URI provides access to the file and read/write permissions. The intent contains information to access the deployed file.</p>

<p>Intent extras:</p>

<table class="facelift" align="center" style="width:90%" border="1" padding="5px">
  <tbody><tr bgcolor="#dce8ef">
    <th>Cursor Key</th>
    <th>Description</th>
  </tr>

  <tr>
    <td>secure_file_name</td>
    <td>Filename or relative file path<br><i>Example:</i> Config.json or /config/Config.json</td>
  </tr>

  <tr>
    <td>secure_file_uri</td>
    <td>File content URI to access the file via SSM File Provider<br><i>Example:</i> content://com.zebra.securestoragemanager/ config/Config.json </td>
  </tr>

 <tr>
    <td>secure_is_dir</td>
    <td>Specifies whether the file URI points to a directory or file. If set to "true", it points to a directory.<br><i>Values:</i> true or false</td>
 </tr>

 <tr>
    <td>secure_file_crc</td>
    <td>MD5 checksum of the file. Applications can use this to determine whether or not the file has already been processed.</td>
 </tr>

 <tr>
    <td>secure_file_persist</td>
    <td>Flag to specify whether or not the file is persistent.<br><i>Values:</i> true or false</td>
 </tr>

</tbody></table>

<p><br></p>

<h4 id="implementabroadcastreceiverinthetargetapptoreceivethefiledeploymentnotification" class="anchor"><a class="heading-anchor" href="#implementabroadcastreceiverinthetargetapptoreceivethefiledeploymentnotification"><span></span></a>Implement a broadcast receiver in the target app to receive the file deployment notification:</h4>

<p>Add to the manifest file:</p>

<pre class="prettyprint"><code>&lt;receiver android:name=".FileNotificationReceiver"&gt;
    &lt;intent-filter &gt;
        &lt;action android:name="com.zebra.configFile.action.notify" /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre>

<p>Implement the broadcast receiver:</p>

<pre class="prettyprint"><code>public class FileNotificationReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(final Context context, Intent intent) {

    if (intent != null &amp;&amp; intent.getAction().equals("com.zebra.configFile.action.notify")) {

        Bundle extras = intent.getExtras();

            if(extras != null &amp;&amp; !extras.isEmpty()) {
                String secure_file_uri = extras.getString("secure_file_uri");
                String secure_file_name = extras.getString("secure_file_name");
                String secure_is_dir = extras.getString("secure_is_dir");
                String secure_file_crc = extras.getString("secure_file_crc");
                String secure_file_persist = extras.getString("secure_file_persist");

                //Read the file(s)
            }
        }
    }
}
</code></pre>

<h3 id="launchedafterdeployment" class="anchor"><a class="heading-anchor" href="#launchedafterdeployment"><span></span></a>Launched After Deployment</h3>

<p>If the target app is launched after the file(s) is deployed, the target app can query the deployed file(s) through SSM via the Content Provider interface. If the target app is verified by SSM, all the file(s) information are returned in the Content Provider cursor. The target app can read the file(s) by using the content URIs available in the Content Provider cursor.</p>

<p>The Content Provider cursor contains the following information:</p>

<table class="facelift" align="center" style="width:90%" border="1" padding="5px">
  <tbody><tr bgcolor="#dce8ef">
    <th>Cursor Key</th>
    <th>Description</th>
  </tr>

  <tr>
    <td>secure_file_name</td>
    <td>Filename or relative file path<br><i>Example:</i> Config.json or /config/Config.json</td>
  </tr>

  <tr>
    <td>secure_file_uri</td>
    <td>File content URI to access the file via SSM file provider<br><i>Example:</i> content://com.zebra.securestoragemanager/config/Config.json </td>
  </tr>

 <tr>
    <td>secure_is_dir</td>
    <td>Determines whether the file URI points to a directory or file. If false, the URI points to a file.<br><i>Values:</i> true or false</td>
 </tr>

 <tr>
    <td>secure_file_crc</td>
    <td>MD5 checksum of the file. This can be checked by an application to determine whether or not the file has been processed.</td>
 </tr>

 <tr>
    <td>secure_file_persist</td>
    <td>Flag to determine whether or not the file is persistent<br><i>Values:</i> true or false</td>
 </tr>

</tbody></table>

<p><br></p>

<p>See <a href="#queryfile">Query File</a> for information on implementation.</p>

<hr>

<h2 id="consumedeployedfile" class="anchor"><a class="heading-anchor" href="#consumedeployedfile"><span></span></a>Consume Deployed File</h2>

<p>The target app consumes the deployed file by using SSM <a href="../api/">Content Provider APIs</a>. If the target app is not registered to receive the intent from SSM when a file is deployed (see <a href="#targetapplaunchedbeforedeployment">Target App Launched Before Deployment</a>), the first step is to <a href="#queryfile">query</a> the file to verify it exists on the device before performing any other operation. </p>

<h3 id="queryfile" class="anchor"><a class="heading-anchor" href="#queryfile"><span></span></a>Query File</h3>

<p>To query the file, the authority and target information (in string format) must be provided. The target must have the file path and persistent flag (true/false) defined. When the query is made to SSM for the deployed files, all the files deployed for the target application are retuned in the Content Provider cursor. </p>

<p>Allow authority is required:</p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/file/*"
Uri cpUriQuery = Uri.parse(AUTHORITY_FILE);
</code></pre>

<p><strong>To query all the deployed files present in SSM for the target application,</strong> add a string that contains the target application package name (target_app_package) and file persistence status (data_persist_required): </p>

<pre class="prettyprint"><code>String selection = "target_app_package = '" + context.getPackagename() + "'" +" AND data_persist_required = 'true'";
</code></pre>

<p><strong>To query a specific file or folder,</strong> the selection string must contain target path and data persistence attributes. The target_path value consists of the target app package name and the file or folder path. </p>

<p>Sample "target_path" values: <code>com.company.targetapp/Folder1/Folder2</code> or <code>com.company.targetapp/Folder1/Folder2/Config.txt</code>.</p>

<pre class="prettyprint"><code>String selection = "target_path = '" + context.getPackageName()+"/folder/" + "' AND  data_persist_required = 'true'";
</code></pre>

<p>where "folder" represents the folder or file path.</p>

<p>See <a href="../api/#queryafilefolder">sample code</a>.</p>

<h3 id="readfile" class="anchor"><a class="heading-anchor" href="#readfile"><span></span></a>Read File</h3>

<p>The resulting cursor from the file query provides the file URI and secure_is_dir to determine if the URI corresponds to a folder or file. If secure_is_dir returns false, the data from the file can be read using the file URI. For security, the target app is granted read permission to the deployed file by SSM based on signature authentication.</p>

<h4 id="samplecode" class="anchor"><a class="heading-anchor" href="#samplecode"><span></span></a>Sample Code</h4>

<p>To read content from the file URI, use Content Resolver:</p>

<pre class="prettyprint"><code>private readFile(Context context , String fileUri) throws IOException {
    InputStream inputStream = context.getContentResolver().openInputStream(Uri.parse(fileUri));
    InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
    BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
    StringBuilder strBuilder = new StringBuilder();
    String line;
    while(null != (line = bufferedReader.readLine())) {
        strBuilder.append(line);
    }
    // To Something with the file content
}
</code></pre>

<h3 id="updatefile" class="anchor"><a class="heading-anchor" href="#updatefile"><span></span></a>Update File</h3>

<pre class="prettyprint"><code>    private final String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files/";

    Uri cpUriQuery = Uri.parse(AUTHORITY_FILE +context.getPackageName());

    try {
        ContentValues values = new ContentValues();
        values.put(COLUMN_TARGET_APP_PACKAGE, String.format("{\"pkgs_sigs\": [{\"pkg\":\"%s\",\"sig\":\"%s\"}]}", context.getPackageName(), signature));
        values.put(COLUMN_DATA_NAME, sourcePath);
        values.put(COLUMN_DATA_TYPE,"1");
        values.put(COLUMN_DATA_VALUE, targetPath);
        values.put(COLUMN_DATA_PERSIST_REQUIRED, persisFlagSpinner.getSelectedItem().toString());
        int rowNumbers = getContentResolver().update(cpUriQuery, values, null , null);
        Log.d(TAG, "Files updated: " + rowNumbers);
        if (rowNumbers &gt; 0) {
            Toast.makeText(mContext, "Files update success", Toast.LENGTH_SHORT).show();
            resultView.setText("Query Result");
        } else {
            Toast.makeText(mContext, "No files to update", Toast.LENGTH_SHORT).show();
        }
    } catch(Exception e){
        Log.d(TAG, "onClickFileUpdate - error: " + e.getMessage());
    }
</code></pre>

<h3 id="deletefile" class="anchor"><a class="heading-anchor" href="#deletefile"><span></span></a>Delete File</h3>

<p>Deployed/shared files can be deleted after use or when the file is no longer required. This is achieved by using the standard Android data API delete(). </p>

<p>Allow Authority is required: </p>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files";
Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE +"/”+context.getPackagename());
</code></pre>

<p>The selection string must contain target path and data persistence attributes. The target_path value consists of the target app package name. </p>

<pre class="prettyprint"><code>String selection = "target_path = '" + context.getPackageName() + "' AND  data_persist_required = 'true'";
</code></pre>

<h4 id="samplecode-1" class="anchor"><a class="heading-anchor" href="#samplecode-1"><span></span></a>Sample Code</h4>

<pre class="prettyprint"><code>private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files";

private void deleteFile() {
    Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE +"/"+context.getPackageName());

    String selection = "target_path = '/context.getPackagename()' AND data_persist_required = 'true'";

    try {
        int deleteStatus = context.getContentResolver().delete(cpUriFileUpdate, selection , null);
        Log.i(TAG, "File deleted status = " + deleteStatus);
    } 
    catch (Exception e) {
        Log.e(TAG, "Delete file error = " + e.getMessage());
    }
}
</code></pre>

<!-- 

### Retrieve Deployed File from Given Target App Path

Allow AUTHORITY: 

    private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files";
    Uri cpUriQuery = Uri.parse(AUTHORITY_FILE +"/com.ztestapp.clientapplication");
    String selection = "target_path = '/com.ztestapp.clientapplication' AND data_persist_required = 'true'";

Sample code to query a deployed file:

    public void onClickQuery(View view) {        

        Cursor cursor = null;
        try {
            cursor = getContentResolver().query(cpUriQuery, null, selection, null, null);
        } catch (Exception e) {
            Log.e(TAG, "Error: "+ e.getMessage());
        }
        try {
            if(cursor !=null && cursor.moveToFirst()){

                StringBuilder strBuilder = new StringBuilder();
                String uriString = null;
                while (!cursor.isAfterLast()) {

                    uriString = cursor.getString (cursor.getColumnIndex("secure_file_uri"));
                    String fileName = cursor.getString(cursor.getColumnIndex("secure_file_name"));
                    String isDir = cursor.getString(cursor.getColumnIndex("secure_is_dir"));
                    String crc = cursor.getString(cursor.getColumnIndex("secure_file_crc"));
                    strBuilder.append("\n");
                    strBuilder.append(uriString).append("\n").append(fileName).append("\n").append(isDir).append("\n").append(crc);
                    cursor.moveToNext();
                }
            }
        } catch (Exception e) {
            Log.e(TAG, "Query data error: " + e.getMessage());
        } finally {
            if(cursor != null){
                cursor.close();
            }
        }
    }

### Read Deployed File Using Content URI

The resulting cursor provides the URI and _isDir_, which determines if the URI corresponds to a folder or file:
* If the URI corresponds with a file, the data from the file can be read using the URI since SSM provides the URI read permission to a calling application package based on the signature authentication. 
* If the URI corresponds with a folder, use the subfolder path as the target path in the selection and send the query again to get the file URI inside the folder. Repeat this process until the file URI is obtained.

To read content from the file URI, use Content Resolver:

    private readFile(Context context , String uriString) throws IOException {

        InputStream inputStream = context.getContentResolver().openInputStream(uriString.parse(uriString));
        InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
        BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
        String strBuilder = new StringBuilder();
        String line;

        while((line = bufferedReader.readLine() != null)) {
            strBuilder.append(line);
        }
        Log.i(TAG, “full content = ” + strBuilder.toString());
    }

### Delete a Deployed File

Deployed files can be deleted after use or when the file is no longer needed. This is achieved by using the standard delete() API from the Android ContentResolver class. SSM Authority (see the previous section) and _whereClause_ are required. Provide the file path in _whereClause_ as <i>target_path</i> of the deployed file. The following sample code uses _com.ztestapp.clientapplication_ as a sample target app package name:

    Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE +"/com.ztestapp.clientapplication");

    String whereClause = "target_path = '/com.ztestapp.clientapplication' AND data_persist_required = 'false'";
    try {
        int deleteStatus = getContentResolver().delete(cpUriFileUpdate, whereClause , null);
        Log.i(TAG, “File deleted status = ” + deleteStatus);
    } 
    catch(Exception e) {
        Log.e(TAG, “Delete file error =  ” + e.getMessage());
    }


### Update a Deployed File

To update a shared deployed file, use the standard Android update() API. The content values can be passed with the file URI as per the data_value. This passes data into the file, replacing the entire content of the file. 

Sample code to update a deployed file:

    Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE +"/com.ztestapp.clientapplication");
    String sourcePathContent = “/sdcard/1.txt”;
    String filePathToUpdate = “/com.ztestapp.clientapplication/1.txt”;

    ContentValues values = new ContentValues();
    values.put(COLUMN_TARGET_APP_PACKAGE, "{\"pkgs_sigs\":[{\"pkg\":\"com.ztestapp.clientapplication\", \"sig\":\"signature_string\"}]}");
    values.put(COLUMN_DATA_NAME, sourcePathContent);
    values.put(COLUMN_DATA_VALUE, filePathToUpdate);
    values.put(COLUMN_DATA_PERSIST_REQUIRED,"true");
    values.put(COLUMN_MULTI_INSTANCE_REQUIRED,"false");
    try {
        int rowNumbers = getContentResolver().update(cpUriFileUpdate, values, null , null);
        Log.i(TAG, “Files Updated = ” + rowNumbers);
    } 
    catch(Exception e) {
        Log.e(TAG, “file update error = ” + e.getMessage());
    }



Note: 
* COLUMN_DATA_NAME = updated content source
* COLUMN_DATA_VALUE = file path to be updated

<br />

-->

<!-- 

---

## App File Sharing

Apps that are sharing files (sharing app) can store the shared file in SSM to be accessed by the intended target app. When deploying shared files via the sharing app, it is required to provide the target app package name and indicate whether or not the shared file shall persist. Although the signature of the target app package is optional, if a signature is not used it poses a potential risk for file security to be compromised. The shared file can be accessed by the target app based on signature verification from SSM.

Zebra recommends to implement Android File Provider in the sharing app and provide read permission to the file URI being shared, so that SSM can read the shared file and store the shared file for the target app.

Sample code demonstrating how the sharing app can store the shared file in SSM and provide the target app package name and signature to SSM:

    const val COLUMN_TARGET_APP_PACKAGE = "target_app_package"
    const val COLUMN_DATA_NAME = "data_name"
    const val COLUMN_DATA_VALUE = "data_value"
    const val COLUMN_DATA_PERSIST_REQUIRED = "data_persist_required"
    const val COLUMN_MULTI_INSTANCE_REQUIRED = "multi_instance_required"
    const val COLUMN_DATA_TYPE = "data_type"  

    File mFilePath = new File(context.getFilesDir().getParentFile().getPath(), "files"); //File path of current app
    File xmlFilePath = new File(new File(mFilePath, context.getPackageName()),”file to share”);

    Uri contentUri = FileProvider.getUriForFile(context, context.getPackageName() + ".provider", xmlFilePath); //Get the content uri to share file. 

    data class Content(var targetPkgName: String = "com.symbol.enterprisehomescreen", var targetPkgSignature: String? = "", 
    var dataName: String, 
    var dataValue: String, 
    var dataPersistRequired: String = "true", 
    val persistConfigValue: String = "")

    //Get the content object to insert.
    Content content = new Content(context.getPackageName(),”target app signature in base64 format”, “data_name”, String.valueOf(contentUri), "true", "3");


    val AUTHORITY = "content://com.zebra.securestoragemanager.securecontentprovider/files/" 

    val uri = Uri.parse(AUTHORITY)  

    val values = ContentValues()
    values.put(COLUMN_TARGET_APP_PACKAGE, "{\"pkgs_sigs\":[{\"pkg\":\"${content.targetPkgName}\",\"sig\":\"${content.targetPkgSignature}\"}]}")

    values.put(COLUMN_DATA_NAME, content.dataName)
    values.put(COLUMN_DATA_VALUE, content.dataValue)
    values.put(COLUMN_DATA_TYPE, content.persistConfigValue)
    values.put(COLUMN_DATA_PERSIST_REQUIRED, content.dataPersistRequired)

    val createdRow = context.contentResolver.insert(uri, values) 

The target app can query the shared file and get the file URI, <i>secure_is_dir</i> value (determines whether it is a directory or file) and CRC (file checksum). The response is received in an Android cursor. The URI returned in the cursor can be read by the target app to read the shared file content:

    val AUTHORITY = "content://com.zebra.securestoragemanager.securecontentprovider/file/*" 
    String selection = COLUMN_TARGET_APP_PACKAGE + " = '" + context.getPackageName() + "'" + "AND " +
    COLUMN_DATA_PERSIST_REQUIRED + " = '" + "true" + "'";

    val cpUriQuery = Uri.parse("$AUTHORITY")Cursor cursor = context.contentResolver.query(cpUriQuery, null, selection, null, null)

<br />

#### For target apps to consume data contained in the deployed file:

In the target app, developers need to add permissions to read/write to SSM. Add these permissions in the Android manifest to allow the target app to update, delete, and/or query the deployed files:

    <uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.WRITE"/>
    <uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.READ"/>

Additionally, the target app must allow SSM authority for Android data/file access by adding the following variable:

    private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files";

<br />

#### Delete a deployed file: 

Deployed files can be deleted after use or when the file is no longer needed. This is achieved by using the standard delete() API from the Android ContentResolver class. SSM authority (see the previous section) and _whereClause_ are required. Provide the file path in _whereClause_ as <i>target_path</i> of the deployed file. The following sample code uses _com.ztestapp.clientapplication_ as a sample target app package name:

    Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE +"/com.ztestapp.clientapplication");
    String whereClause = "target_path = '/com.ztestapp.clientapplication' AND data_persist_required = 'false'";
    try {
        int deleteStatus = getContentResolver().delete(cpUriFileUpdate, whereClause, null);
        Log.i(TAG, “File deleted status = " + deleteStatus);
    } 
    catch(Exception e) {
        Log.e(TAG, “Delete file error =  " + e.getMessage());
    }


<br />

#### Update a deployed file:

To update a deployed file that is being shared, use the standard Android update() API. The content values can be passed with the file URI as per the data_value. This passes data into the file, replacing the entire content of the file. 

Sample code to update a deployed file:

    Uri cpUriFileUpdate = Uri.parse(AUTHORITY_FILE +"/com.ztestapp.clientapplication");
    String sourcePathContent = “/sdcard/1.txt”;
    String filePathToUpdate = “/com.ztestapp.clientapplication/1.txt”;

    ContentValues values = new ContentValues();
    values.put(COLUMN_TARGET_APP_PACKAGE, "{\"pkgs_sigs\":[{\"pkg\":\"com.ztestapp.clientapplication\",\"sig\":\"signature_string\"}]}");
    values.put(COLUMN_DATA_NAME, sourcePathContent);
    values.put(COLUMN_DATA_VALUE, filePathToUpdate);
    values.put(COLUMN_DATA_PERSIST_REQUIRED,"true");
    values.put(COLUMN_MULTI_INSTANCE_REQUIRED,"false");

    try {
        int rowNumbers = getContentResolver().update(cpUriFileUpdate, values, null , null);
        Log.i(TAG, “Files Updated = ” + rowNumbers)
    } 
    catch(Exception e) {
        Log.e(TAG, “file update error = ” + e.getMessage())
    }




Note: 
* COLUMN_DATA_NAME - updated content source
* COLUMN_DATA_VALUE - file path to be updated

<br />



#### Manifest Permissions

Manifest permissions need to be changed in your app if there is a need to update, delete, and/or query the deployed files. The following permissions are required in the manifest for any of these operations: 

    <uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.WRITE"/>
    <uses-permission android:name="com.zebra.securestoragemanager.securecontentprovider.PERMISSION.READ"/>

##### Retrieve folder/subfolder/file in the target application:

To retrieve the deployed config file from the given target application path, allow AUTHORITY:

    private String AUTHORITY_FILE = "content://com.zebra.securestoragemanager.securecontentprovider/files";
    Uri cpUriQuery = Uri.parse(AUTHORITY_FILE +"/com.ztestapp.clientapplication");
    String selection = "target_path = '/com.ztestapp.clientapplication' AND data_persist_required = 'true'";



Sample code to query a deployed file:

    public void onClickQuery(View view) {        

        Cursor cursor = null;
        try {
            cursor = getContentResolver().query(cpUriQuery, null, selection, null, null);
        } 
        catch (Exception e) {
            Log.e(TAG, "Error: "+ e.getMessage());
        }
        try {
            if(cursor !=null && cursor.moveToFirst()) {
                StringBuilder strBuilder = new StringBuilder();
                String uriString = null;
                while (!cursor.isAfterLast()) {

                    uriString = cursor.getString (cursor.getColumnIndex("secure_file_uri"));
                    String fileName = cursor.getString(cursor.getColumnIndex("secure_file_name"));
                    String isDir = cursor.getString(cursor.getColumnIndex("secure_is_dir"));
                    String crc = cursor.getString(cursor.getColumnIndex("secure_file_crc"));
                    strBuilder.append("\n");
                    strBuilder.append(uriString).append("\n").append(fileName).append("\n").append(isDir).append("\n").append(crc);
                    cursor.moveToNext();
                }
            }
        } 
        catch (Exception e) {
            Log.e(TAG, "Query data error: " + e.getMessage());
        } 
        finally {
            if(cursor != null) {
                cursor.close();
            }
        }
    }

#### Reading files using Content URIs:

The resulting cursor provides the URI and _isDir_, which determines if the URI corresponds to a folder or file:
* If the URI corresponds with a file, the data from the file can be read using the URI since SSM provides the URI read permission to a calling application package based on the signature authentication. 
* If the URI corresponds with a folder, use the subfolder path as the target path in the selection and send the query again to get the file URI inside the folder. Repeat this process until the file URI is obtained.

To read content from the file URI, use Content Resolver:

    private readFile(Context context, String uriString) throws IOException {
        InputStream inputStream = context.getContentResolver().openInputStream(uriString.parse(uriString));
        InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
        BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
        String strBuilder = new StringBuilder();
        String line;

        while((line = bufferedReader.readLine() != null)) {
            strBuilder.append(line)
        }

        Log.i(TAG, “full content = ” + strBuilder.toString());
    }

-->

<hr>

<h2 id="seealso" class="anchor"><a class="heading-anchor" href="#seealso"><span></span></a>See Also</h2>

<ul>
<li><a href="../about/">About SSM</a></li>

<li><a href="../share-data">Data Sharing</a></li>

<li><a href="../api/">APIs</a></li>
</ul><p></p>
                                        


                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div><!--/.col-sm-6-->
            </div>
            </section>
        </div>
    </section>    

<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true" data-backdrop="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
					</div>
					<div class="modal-body">
						<div id="modalImg">
						
						</div>
					</div>
			</div>
		  </div>
		</div> </div>
         <footer id="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-10">
                        ZEBRA and the stylized Zebra head are trademarks of Zebra Technologies Corp., registered in many jurisdictions worldwide. All other trademarks are the property of their respective owners. ©2022 Zebra Technologies Corp. and/or its affiliates.<br> <a href="https://www.zebra.com/us/en/about-zebra/company-information/legal.html">Legal</a> | <a href="https://www.zebra.com/us/en/about-zebra/company-information/compliance/information-privacy/terms-of-use.html">Terms of Use</a> | <a href="https://www.zebra.com/us/en/about-zebra/company-information/legal/privacy-statement.html">Privacy Policy</a> 
                    </div>
                     <!--
                     <div class="col-sm-2">
                        <ul class="social-icons">
                            <li><a href="http://www.facebook.com/pages/Zebra-Technologies/107703715989073"><i class="fa fa-facebook"></i></a></li>
                            <li><a href="https://twitter.com/ZebraDevs"><i class="fa fa-twitter"></i></a></li>
                            <li><a href="http://www.youtube.com/zebratechnologies/"><i class="fa fa-youtube"></i></a></li>
                            <li><a href="https://www.linkedin.com/groups?home=&gid=3220074&trk=anet_ug_hm&goback=%2Egmr_3220074"><i class="fa fa-linkedin"></i></a></li>
                            <li><a href="https://github.com/developer-zebra"><i class="fa fa-github"></i></a></li>
                        </ul>
                    </div> -->
                 </div>
            </div>
        </footer>
    
    <!--/#footer 
        10/25/18 removed <footer id="footer" class="navbar-fixed-bottom">
    -->
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/mousescroll.js"></script>
    <script src="/js/smoothscroll.js"></script>
    <script src="/js/jquery.prettyPhoto.js"></script>
    <script src="/js/jquery.isotope.min.js"></script>
    <script src="/js/jquery.inview.min.js"></script>
    <script src="/js/wow.min.js"></script>
    <script src="/js/bootstrap-treenav.min.js"></script>
    <script src="/js/prettify.js"></script>
    <script src="/js/zepto.js"></script>
    <script src="/js/jquery.waterfall.js"></script>   
    <script src="/js/main.js"></script>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','zRzEsAUhWTTkrdEN2YfA','2.0.0');
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72584442-1', 'auto');
  ga('send', 'pageview');

</script> 

<script>
    ChatraID = 'QDvZ76min4DhLW5vJ';
    (function(d, w, c) {
        var n = d.getElementsByTagName('script')[0],
            s = d.createElement('script');
        w[c] = w[c] || function() {
            (w[c].q = w[c].q || []).push(arguments);
        };
        s.async = true;
        s.src = (d.location.protocol === 'https:' ? 'https:': 'http:')
            + '//call.chatra.io/chatra.js';
        n.parentNode.insertBefore(s, n);
    })(document, window, 'Chatra');
</script>         


</body></html>